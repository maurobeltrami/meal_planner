{% load static %}

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpesaFacile | Piano Settimanale</title>
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    
    <h1>üçΩÔ∏è SpesaFacile | Piano Settimanale dei Pasti</h1>

    <div class="forms-container">
        
        <div class="action-box">
            <a href="{% url 'shopping_list' %}" class="big-link style-shopping">
                <i class="fas fa-shopping-cart"></i>
                <div>
                    <strong>Lista della Spesa</strong>
                    <small>Aggrega gli ingredienti della settimana.</small>
                </div>
            </a>
        </div>
        
        <div class="action-box">
            <a href="{% url 'recipe_management' %}" class="big-link style-list">
                <i class="fas fa-list-ul"></i>
                <div>
                    <strong>Gestisci Ricette</strong>
                    <small>Visualizza, crea e modifica tutte le ricette nel ricettario.</small>
                </div>
            </a>
        </div>
        
        <div class="action-box">
            <form method="post" action="{% url 'reset_weekly_plan' %}">
                {% csrf_token %}
                <button type="submit" class="big-link style-reset" onclick="return confirm('Sei sicuro di voler cancellare TUTTO il piano settimanale? Questa azione non pu√≤ essere annullata.');">
                    <i class="fas fa-trash-alt"></i>
                    <div>
                        <strong>Reset Settimana</strong>
                        <small>Svuota tutti i pasti pianificati.</small>
                    </div>
                </button>
            </form>
        </div>
    </div>
    <div class="form-section">
        <h3>Piano Settimanale</h3>
        <div class="grid-wrapper">
            <div class="grid-container">
            
                <div class="header">Giorno</div>
                {% for meal_code, meal_name in meal_types %}
                    <div class="header">{{ meal_name }}</div>
                {% endfor %}

                {% for day_code, day_data in meal_grid.items %}
                    
                    <div class="cell day-cell">{{ day_data.name }}</div>
                    
                    {% for meal_type, slot_data in day_data.meals.items %}
                        <div class="cell meal-cell">
                            
                            {% if slot_data %}
                                {% for recipe in slot_data.recipes %}
                                    <span class="recipe-name-display">{{ recipe.name }}</span>
                                {% endfor %}
                                
                                <a href="{% url 'meal_slot_update' pk=slot_data.slot_obj.pk %}" class="edit-slot-link">
                                    <i class="fas fa-edit"></i> Modifica
                                </a>
                                
                            {% else %}
                                <a href="{% url 'meal_slot_create' day=day_code meal_type=meal_type %}" class="create-slot-link">
                                    <i class="fas fa-plus"></i> Pianifica
                                </a>
                            {% endif %}
                            
                        </div>
                    {% endfor %}
                    
                {% endfor %}
            
            </div>
            </div>
    </div>

</body>
</html>